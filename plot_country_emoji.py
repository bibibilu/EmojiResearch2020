import pyspark
import json
import re
import os
import emoji
import regex
import matplotlib.pyplot as plt
import numpy as np
from itertools import count
import seaborn as sns

file_oct = '/Users/claire/Desktop/599/project/research/data/2016-geotag-october'
input_file = '/Users/claire/Desktop/599/project/research/data/2016-geotag-october/twitter-decahose-geotag-content-result-2016-10-02.json'

sc = pyspark.SparkContext()   # 'local[*]'
sc.setLogLevel("OFF")
# mydata = sc.textFile(file_oct).map(lambda x: json.loads(x))
# submydata = sc.textFile(input_file).map(lambda x: json.loads(x))
# total_rows = mydata.count()   # 19562132


def select_text_cty(file):
    mydata = sc.textFile(file).map(lambda x: json.loads(x))
    tweets = mydata.filter(lambda x: x['place'] is not None and x['place']['country_code'] is not None).map(lambda x: (x['text'], x['place']['country_code']))

    return tweets


def get_cty_tweets_distribution(tweets):
    countries = tweets.map(lambda x: (x[1], 1)).reduceByKey(lambda x, y: x+y).sortBy(lambda x: -x[1])
    cty_name = countries.keys().collect()
    num_cty = countries.count()
    print(num_cty)

    cty_tweets_count = countries.collect()
    print(cty_tweets_count)
    # [('US', 6726826), ('BR', 2499041), ('JP', 1124317), ('GB', 967584), ('AR', 748262), ('PH', 579842), ('MY', 507092), ('TR', 498124), ('ES', 475227), ('FR', 404235), ('ID', 374214), ('MX', 346972), ('TH', 339530), ('SA', 282744), ('CA', 279528), ('RU', 248574), ('CO', 182268), ('IT', 179394), ('IN', 178464), ('VE', 145321), ('PT', 136169), ('ZA', 135426), ('CL', 121007), ('AU', 119853), ('DE', 111564), ('EG', 100959), ('UY', 100386), ('KW', 100063), ('NL', 92981), ('AE', 84995), ('NG', 73716), ('IE', 61087), ('KR', 52057), ('PL', 50993), ('PE', 48413), ('SE', 47409), ('BE', 45287), ('UA', 43015), ('SG', 42397), ('EC', 42269), ('PK', 39850), ('PY', 33919), ('BY', 31047), ('QA', 27073), ('CR', 26246), ('KE', 23819), ('GR', 22697), ('DO', 22684), ('NZ', 21601), ('BH', 21130), ('CN', 19205), ('PA', 18767), ('FI', 18655), ('CH', 18498), ('OM', 16791), ('GH', 16355), ('IL', 16020), ('GT', 15823), ('NO', 15353), ('TW', 13864), ('LB', 13678), ('IQ', 13499), ('RS', 13425), ('HK', 13099), ('JO', 12360), ('DK', 11735), ('AT', 11598), ('CZ', 10891), ('JM', 10789), ('NI', 10776), ('DZ', 10541), ('LY', 10218), ('MA', 8683), ('NP', 8670), ('CY', 8337), ('VN', 7687), ('LV', 7298), ('SV', 6746), ('KZ', 6432), ('BD', 6172), ('TT', 6095), ('HU', 6026), ('RO', 5961), ('SD', 5724), ('UG', 5404), ('IR', 5341), ('MN', 5259), ('HN', 5216), ('TZ', 5213), ('BW', 4980), ('LK', 4825), ('HR', 4762), ('BS', 4401), ('CM', 4344), ('IS', 4060), ('AZ', 3974), ('BG', 3813), ('CI', 3812), ('BB', 3729), ('SI', 3494), ('MQ', 3472), ('AO', 3324), ('BO', 3195), ('GU', 3171), ('SN', 3150), ('BN', 3089), ('HT', 2986), ('TN', 2950), ('AG', 2943), ('ZW', 2883), ('ME', 2710), ('BA', 2633), ('ZM', 2501), ('YE', 2480), ('MZ', 2308), ('NA', 2249), ('SK', 2230), ('MK', 2200), ('GP', 2114), ('MV', 2041), ('XK', 1974), ('EE', 1956), ('MT', 1879), ('GE', 1707), ('LU', 1635), ('KH', 1635), ('LT', 1616), ('CU', 1459), ('CD', 1419), ('UZ', 1303), ('SY', 1299), ('MW', 1292), ('PR', 1257), ('KG', 1184), ('MO', 1162), ('MM', 1111), ('MU', 1107), ('LC', 1082), ('AM', 1017), ('MP', 1012), ('RE', 974), ('AQ', 939), ('CG', 928), ('MD', 882), ('RW', 848), ('BM', 846), ('LS', 844), ('', 833), ('KY', 821), ('IM', 800), ('VG', 761), ('LA', 718), ('FJ', 703), ('AF', 692), ('MC', 663), ('GI', 661), ('TC', 659), ('GF', 648), ('NC', 645), ('AL', 634), ('AW', 634), ('SZ', 543), ('BJ', 493), ('KP', 471), ('MG', 450), ('SO', 401), ('PF', 386), ('VA', 369), ('VC', 369), ('MR', 334), ('CW', 327), ('AD', 327), ('ML', 306), ('GA', 301), ('GD', 287), ('SX', 284), ('TG', 266), ('BZ', 265), ('SR', 261), ('VI', 255), ('AS', 253), ('BT', 245), ('GY', 230), ('BF', 225), ('KN', 221), ('GN', 218), ('GL', 213), ('NE', 199), ('TJ', 191), ('CV', 165), ('MF', 161), ('ET', 160), ('DM', 160), ('GM', 157), ('LR', 152), ('SL', 147), ('BQ', 138), ('FO', 136), ('SM', 136), ('PG', 108), ('SC', 106), ('DJ', 106), ('WS', 101), ('YT', 101), ('BI', 99), ('GQ', 96), ('TO', 84), ('CF', 70), ('TL', 59), ('FK', 58), ('TM', 57), ('AX', 55), ('FM', 55), ('MH', 49), ('GG', 49), ('CX', 46), ('AI', 46), ('ER', 45), ('JE', 45), ('SB', 45), ('CK', 44), ('TD', 40), ('LI', 39), ('VU', 36), ('PW', 29), ('ST', 28), ('BL', 23), ('MS', 20), ('NF', 19), ('SH', 16), ('PM', 15), ('UM', 13), ('BV', 12), ('TF', 12), ('GW', 11), ('GS', 9), ('KM', 8), ('NU', 7), ('WF', 6), ('KI', 6), ('EH', 6), ('CC', 3), ('IO', 2), ('TV', 1), ('PN', 1), ('NR', 1)]
    # [('United States', 6648419), ('Brasil', 2270904), ('日本', 970723), ('United Kingdom', 953815), ('Argentina', 748044), ('Republic of the Philippines', 571180), ('Malaysia', 506035), ('Türkiye', 464530), ('España', 412238), ('France', 396335), ('Indonesia', 373878), ('México', 295922), ('Canada', 275102), ('Brazil', 225924), ('Россия', 223036), ('ประเทศไทย', 190740), ('Colombia', 182268), ('المملكة العربية السعودية', 179907), ('India', 172670), ('Italia', 147873), ('Thailand', 147767), ('Japan', 146503), ('Venezuela', 145321), ('Portugal', 136168), ('South Africa', 135426), ('Chile', 120898), ('Australia', 119853), ('Kingdom of Saudi Arabia', 102569), ('Uruguay', 100148), ('Egypt', 80864), ('Deutschland', 75088), ('Nigeria', 73716), ('Estados Unidos', 71196), ('Kuwait', 69771), ('United Arab Emirates', 65901), ('Nederland', 58961), ('Ireland', 58637), ('Mexico', 50171), ('Peru', 48413), ('Ecuador', 42269), ('Polska', 40222), ('Singapore', 39950), ('Pakistan', 38217), ('Spain', 37924), ('대한민국', 36238), ('Paraguay', 33919), ('Turkey', 30640), ('The Netherlands', 30554), ('Украина', 30364), ('دولة الكويت', 30257), ('Germany', 29953), ('Italy', 28789), ('Беларусь', 28635), ('Sverige', 26709), ('Costa Rica', 26246), ('Russia', 24118), ('Kenya', 22819), ('Dominican Republic', 22684), ('België', 20061), ('New Zealand', 19822), ('Sweden', 19283), ('Qatar', 19148), ('Espanya', 18972), ('مصر', 18922), ('Bahrain', 17712), ('الامارات العربية المتحدة', 17223), ('Ghana', 16355), ('Guatemala', 15823), ('Republic of Korea', 15819), ('Panamá', 15389), ('Iraq', 13499), ('Belgium', 12927), ('Lebanon', 12350), ('Ελλάς', 11214), ('Jamaica', 10785), ('Nicaragua', 10776), ("People's Republic of China", 10708), ('Greece', 10427), ('Libya', 10197), ('Hong Kong', 10118), ('Belgique', 10017), ('Suomi', 9696), ('Israel', 9628), ('Oman', 9581), ('Hashemite Kingdom of Jordan', 9171), ('Republic of Serbia', 8997), ('台灣', 8993), ('Poland', 8811), ('Norway', 8763), ('Nepal', 8657), ('Finland', 8578), ('Cyprus', 8071), ('中华人民共和国', 7971), ('دولة قطر', 7784), ('Україна', 7763), ('Reino Unido', 7493), ('Algérie', 7246), ('سلطنة عمان', 7189), ('Republika ng Pilipinas', 7050), ('El Salvador', 6746), ('Switzerland', 6568), ('Kazakhstan', 6423), ('ישראל', 6392), ('Österreich', 6315), ('Bangladesh', 6172), ('Trinidad and Tobago', 6079), ('Norge', 5921), ('Denmark', 5878), ('Schweiz', 5720), ('Sudan', 5681), ('भारत', 5527), ('Česká republika', 5523), ('Uganda', 5403), ('Danmark', 5330), ('Royaume du Maroc', 5277), ('Honduras', 5216), ('Mongolia', 5215), ('Tanzania', 5195), ('Francia', 5176), ('Etats-Unis', 5036), ('Botswana', 4978), ('Austria', 4973), ('Sri Lanka', 4825), ('Ukraine', 4807), ('Czech Republic', 4758), ('Taiwan', 4704), ('Islamic Republic of Iran', 4477), ('Bahamas', 4401), ('Suisse', 4400), ('Cameroon', 4341), ('Vietnam', 4234), ('Srbija', 4169), ('Canadá', 3950), ('Azerbaijan', 3924), ('Alemania', 3758), ('Barbados', 3729), ('Iceland', 3701), ('Latvia', 3655), ('Latvija', 3561), ('Martinique', 3470), ('مملكة البحرين', 3405), ('Panama', 3378), ('Romania', 3351), ('Angola', 3324), ("Côte d'Ivoire", 3291), ('Republic of Croatia', 3289), ('Việt Nam', 3256), ('Bolivia', 3179), ('Guam', 3171), ('Senegal', 3150), ('Royaume-Uni', 3138), ('المملكة الأردنية الهاشمية', 3026), ('Brunei', 2995), ('Republic of Slovenia', 2991), ('Haiti', 2966), ('Antigua and Barbuda', 2937), ('香港', 2929), ('Zimbabwe', 2881), ('Bulgaria', 2872), ('Magyarország', 2872), ('Hungary', 2753), ('Zambia', 2500), ('Yemen', 2478), ('일본', 2356), ('România', 2341), ('الجزائر', 2247), ('Namibia', 2238), ('Guadeloupe', 2114), ('Espagne', 2088), ('Morocco', 2073), ('Maldives', 2023), ('Republic of Belarus', 2019), ('Former Yugoslav Republic of Macedonia', 1924), ('Bélgica', 1859), ('Kosovo', 1858), ('Holanda', 1842), ('Tunisie', 1835), ('Regno Unito', 1773), ('Malta', 1767), ('Irlanda', 1716), ('Georgia', 1690), ('Bosnia and Herzegovina', 1649), ('新加坡', 1621), ('Cambodia', 1548), ('Turquía', 1532), ('França', 1508), ('Luxembourg', 1507), ('República de Filipinas', 1503), ('Montenegro', 1468), ('Cuba', 1446), ('Vereinigte Staaten', 1417), ('Polonia', 1328), ('República de Moçambique', 1316), ('Malawi', 1292), ('Uzbekistan', 1286), ('Estonia', 1248), ('Crna Gora', 1203), ('Brésil', 1181), ('Kyrgyzstan', 1181), ('Japon', 1168), ('Slovak Republic', 1143), ('Myanmar', 1111), ('Saint Lucia', 1081), ('Japón', 1075), ('Emiratos Árabes Unidos', 1023), ('Spanien', 1019), ('Armenia', 1012), ('Espanha', 1008), ('Northern Mariana Islands', 1007), ('Kenia', 1000), ('Stati Uniti', 994), ('Lithuania', 990), ('Republic of Mozambique', 988), ('Algeria', 987), ('لبنان', 982), ('La Réunion', 974), ('Itália', 951), ('Antarctica', 932), ('Egipto', 927), ('Malasia', 923), ('Slovenská republika', 922), ('Japão', 907), ('Italie', 902), ('Suecia', 895), ('Bosna i Hercegovina', 889), ('Allemagne', 882), ('المملكة المغربية', 875), ('Moldova', 868), ('България', 855), ('Congo', 849), ('Lesotho', 844), ('پاکستان', 843), ('Bermuda', 843), ('Hrvatska', 841), ('جمهوری اسلامی ایران', 836), ('Nueva Zelanda', 836), ('Spagna', 831), ('Cayman Islands', 809), ('Isle of Man', 800), ('Syria', 798), ('Republic of Mauritius', 796), ('Macau', 795), ('Pakistán', 790), ('Rwanda', 781), ('Tunisia', 772), ('Singapur', 760), ('British Virgin Islands', 758), ('Rusia', 755), ('République Démocratique Du Congo', 751), ('', 741), ('Italien', 718), ('Frankreich', 717), ("Lao People's Democratic Republic", 707), ('Fiji', 698), ('Vereinigtes Königreich', 693), ('Afghanistan', 681), ('Gibraltar', 660), ('Eesti', 658), ('Turks and Caicos Islands', 649), ('Monaco', 643), ('Suiza', 639), ('Aruba', 634), ('Democratic Republic of Congo', 630), ('Svizzera', 622), ('Guyane Française', 614), ('Nouvelle-Calédonie', 612), ('Germania', 601), ('Brasile', 601), ('Alemanha', 580), ('ญี่ปุ่น', 577), ('Duitsland', 576), ('Albania', 573), ('Thaïlande', 565), ('Mexique', 562), ('Espainia', 560), ('Türkei', 558), ('ニュージーランド', 557), ('Swaziland', 543), ('Lietuva', 535), ('Pays-Bas', 523), ('Niederlande', 517), ('Ivory Coast', 516), ('Spanje', 483), ('Syrian Arab Republic', 466), ('Turquie', 462), ('Madagascar', 450), ('Emirats Arabes Unis', 448), ('Verenigde Staten', 436), ('Croatie', 412), ('Suíça', 409), ('Grecia', 408), ('Noruega', 407), ('Somalia', 401), ('Brasilien', 394), ('Япония', 393), ('Slovenija', 390), ('Irlande', 377), ('Saint Vincent and the Grenadines', 368), ('Amerikas förenta stater', 364), ('Tailandia', 362), ('澳門', 359), ('Frankrijk', 350), ('Mauritania', 334), ('Grèce', 325), ('Andorra', 313), ('Paesi Bassi', 309), ('Mali', 306), ("Belarus'", 304), ('Liban', 302), ('Gabon', 300), ('Verenigd Koninkrijk', 291), ('République de Maurice', 289), ('Reino de Marruecos', 287), ('République du Bénin', 286), ('Polynésie Française', 285), ('Grenada', 284), ('تونس', 282), ("Democratic People's Republic of Korea (North Korea)", 281), ('Polen', 277), ('República Checa', 270), ('Curaçao', 265), ('Sint Maarten', 264), ('Suriname', 257), ('Virgin Islands, U.S.', 255), ('American Samoa', 253), ('Belize', 252), ('Russland', 252), ('Canadà', 249), ('Поранешна Југословенска Република Македонија', 246), ('Bhutan', 245), ('Storbritannien', 243), ('Dinamarca', 243), ('République populaire de Chine', 242), ('Holanda (Países Baixos)', 241), ('Uruguai', 238), ('Belgio', 236), ('Guyana', 230), ('Kanada', 227), ('Burkina Faso', 225), ('Pologne', 224), ('Saint Kitts and Nevis', 215), ('Κύπρος', 210), ('Turkije', 210), ('Russie', 208), ('Benin', 207), ('Emirados Árabes Unidos', 204), ('Giappone', 201), ('Niger', 199), ('República Popular China', 196), ('Jepang', 192), ('Ísland', 191), ('Griechenland', 190), ('Hungría', 189), ('Tajikistan', 188), ('République Togolaise', 186), ('Argentine', 178), ("Royaume d'Arabie Saoudite", 177), ('Viêtnam', 174), ('Messico', 173), ('Vatican City', 169), ('Belgien', 168), ('Irland', 168), ('Egypte', 165), ('Italië', 161), ('Greenland', 159), ('North Korea', 155), ('Eire', 154), ('Inde', 153), ('Ethiopia', 153), ('Finlandia', 152), ('Liberia', 151), ('Autriche', 151), ('Gambia', 150), ('Rumanía', 150), ('Finlândia', 146), ('Schweden', 144), ('Dominica', 143), ('Sierra Leone', 141), ('Bonaire, Sint Eustatius and Saba', 138), ('Mexiko', 138), ('San Marino', 135), ('Cape Verde', 134), ('Faroe Islands', 133), ('Zwitserland', 131), ('Frankrike', 131), ('Catar', 128), ('Indonésie', 127), ('Polónia', 124), ('Suède', 123), ('Turchia', 119), ('Guinée', 118), ('Reino Hachemita de Jordania', 118), ('Republik Serbien', 113), ('Malte', 112), ('Taïwan', 111), ('República Eslovaca', 111), ('Tyskland', 110), ('Chili', 109), ('Saint-Martin', 108), ('Kosovë', 107), ('Djibouti', 106), ('Dänemark', 106), ('Papua New Guinea', 104), ('Tschechische Republik', 103), ('Seychelles', 103), ('Mayotte', 101), ('Samoa', 101), ('Guinea', 100), ('Burundi', 99), ('Zweden', 98), ('République Tchèque', 96), ('Ryssland', 96), ('French Polynesia', 94), ('Negara Brunei Darussalam', 94), ('Puerto Rico', 92), ('اليابان', 89), ('Luxemburg', 88), ('Volksrepublik China', 88), ('Indonesien', 88), ('Città del Vaticano', 87), ('Japonya', 86), ('República da Índia', 85), ('Tonga', 84), ('Islandia', 84), ('Yhdistynyt kuningaskunta', 84), ('Norwegen', 84), ('Espanja', 83), ('Congo Brazzaville', 81), ('Marokko', 81), ('Indonesië', 80), ('Oostenrijk', 80), ('Norvège', 80), ('Togo', 80), ('Yhdysvallat', 78), ('Republik der Philippinen', 78), ('Kroatien', 78), ('Ciudad del Vaticano', 76), ('USA', 75), ('Vereinigte Arabische Emirate', 74), ('Nouvelle-Zélande', 71), ('Norvegia', 70), ('Nova Zelândia', 70), ('Danemark', 70), ('Repubblica Ceca', 69), ('Tailândia', 68), ('De Forente Stater', 68), ('République du Rwanda', 66), ('Ungarn', 63), ('Curazoa', 62), ('Suécia', 62), ('Croacia', 62), ('Danimarca', 62), ('뉴질랜드', 61), ('Rússia', 61), ('Marrocos', 61), ('Svezia', 60), ('Equatorial Guinea', 60), ('Singapour', 59), ('Falkland Islands (Malvinas)', 58), ('Argelia', 58), ('นิวซีแลนด์', 58), ('Malaisie', 58), ('Emirati Arabi Uniti', 56), ('Taiwán', 56), ('Aland Islands', 55), ('Federated States of Micronesia', 55), ('Central African Republic', 55), ('Turkmenistan', 55), ('Tsjechische Republiek', 54), ('Groenland', 54), ('Islande', 53), ('Griekenland', 53), ('نيوزيلندا', 53), ('Ägypten', 53), ('Saint Martin', 52), ('Hongkong', 52), ('Cambodge', 51), ('Guernsey', 49), ('Marshall Islands', 49), ('Shqipëria', 49), ('République Serbe', 49), ('East Timor', 47), ('Christmas Island', 46), ('Roumanie', 46), ('Anguilla', 46), ('Jersey', 45), ('Eslovenia', 45), ('Eritrea', 45), ('Solomon Islands', 45), ('Áustria', 45), ('Grécia', 44), ('Bosnia y Herzegovina', 44), ('Cook Islands', 44), ('Lituania', 43), ('Soudan', 43), ('Croazia', 43), ('Aserbaidschan', 43), ('Finlande', 42), ('Verenigde Arabische Emiraten', 42), ('Indonésia', 41), ('Lettland', 41), ('Serbia', 41), ('Finnland', 41), ('Rusland', 40), ('Luxemburgo', 40), ('Royaume hachémite de Jordanie', 39), ('Hongrie', 39), ('Ucrania', 39), ('Liechtenstein', 39), ('República de Serbia', 38), ('Hungria', 37), ('Argentinien', 37), ('Slovenia', 37), ('Vanuatu', 36), ('Ruotsi', 35), ('Hongarije', 35), ('Camboya', 35), ('Mongolei', 34), ('Chad', 34), ('República Popular Democrática de Corea (Corea del Norte)', 33), ('Rumänien', 32), ('New Caledonia', 32), ('Brazilië', 32), ('Malásia', 32), ('République des Philippines', 31), ('Island', 31), ('Ierland', 31), ('Turkiet', 31), ('Ungheria', 30), ('Biélorussie', 30), ('República de Montenegro', 30), ('Denemarken', 29), ('Storbritannia', 29), ('Palau', 29), ('Weissrussland', 29), ('Turquia', 29), ('Malesia', 28), ('Lituanie', 28), ('Egitto', 27), ('Grekland', 27), ('Bulgária', 26), ('French Guiana', 26), ('Bulgarie', 26), ('Republik Indien', 26), ('Österrike', 25), ('Bielorrusia', 25), ('Roménia', 24), ('República Democrática del Congo', 24), ('An Rioghachd Aonaichte', 24), ('Cabo Verde', 23), ('Vietname', 23), ('Marocco', 23), ('Chipre', 23), ('Bulgarien', 22), ('Líbano', 22), ('Koweit', 22), ('Túnez', 22), ('Japán', 22), ('Antigua República Yugoslava de Macedonia', 21), ('Spania', 21), ('Omán', 21), ('Slowakische Republik', 20), ('Bosnië en Herzegovina', 20), ('Tunísia', 20), ('République de Slovaquie', 20), ('Haití', 20), ('Montserrat', 20), ('Estland', 20), ('Mónaco', 20), ('São Tomé and Príncipe', 19), ('Bosnien und Herzegowina', 19), ('Belgia', 19), ('La isla de San Martín', 19), ('Chypre', 19), ('Norfolk Islands', 19), ('Guinée équatoriale', 18), ('Japonia', 18), ('Siria', 18), ('Saudi Arabien', 18), ('Guinea Ecuatorial', 18), ('Ucrânia', 18), ('Libanon', 17), ('Koenigreich Saudi-Arabien', 17), ('Dominique', 17), ('Roemenië', 17), ('Tanska', 17), ('Nuova Zelanda', 17), ('Noorwegen', 17), ('Saksa', 16), ('Koninkrijk Saudi-Arabië', 16), ('Maleisië', 16), ('Islamische Republik Iran', 16), ('Nederländerna', 16), ('Saint Helena, Ascension and Tristan Da Cunha', 16), ('Croácia', 15), ('Reino da Arábia Saudita', 15), ('Libia', 15), ('Nieuw-Zeeland', 15), ('La Cité du Vatican', 15), ('République centrafricaine', 15), ('Thaimaa', 15), ('Saint Barthélemy', 14), ('Litauen', 14), ('Letonia', 14), ('Oekraïne', 14), ('Reino de Arabia Saudi', 14), ('República de Mauricio', 14), ('Andorre', 14), ('Viro', 14), ('United States Minor Outlying Islands', 13), ('Trinidad y Tobago', 13), ('Tansania', 13), ('Maldivas', 13), ('Belice', 13), ('Kongeriket Thailand', 13), ('Lettonie', 13), ('Koweït', 13), ('Kuba', 13), ('Népal', 13), ('Katar', 13), ('Georgien', 13), ('Syrie', 12), ('Bulgarije', 12), ('Frankrig', 12), ('Cidade do Vaticano', 12), ('Bouvet Island', 12), ('De Förenade Arabiska Emiraterna', 12), ('French Southern and Antarctic Lands', 12), ('Новая Зеландия', 12), ('Timor-Leste', 12), ('Kroatië', 12), ('Afganistán', 11), ('Norja', 11), ('Serbien', 11), ('Neuseeland', 11), ('Arabia Saudita', 11), ('Ouzbékistan', 11), ('Tunisi', 11), ('Tjeckien', 11), ('Laos', 11), ('Bolivie', 11), ('Ucraina', 10), ('Estonie', 10), ('Kroatia', 10), ('Mongolie', 10), ('Islas Turcas y Caicos', 10), ('Alankomaat', 10), ('Saint Pierre and Miquelon', 9), ('Eslováquia', 9), ('Slowenien', 9), ('South Georgia and the South Sandwich Islands', 9), ('Democratic Republic of São Tomé and Príncipe', 9), ('Slovenien', 9), ('Cossovo', 9), ('Saint-Barthélemy', 9), ('République de Slovénie', 8), ('Nederlandene', 8), ('Sveitsi', 8), ('Selandia Baru', 8), ('République du Monténégro', 8), ('Arabiemiirikunnat', 8), ('Tyrkiet', 8), ('Macao', 8), ('Zypern', 8), ('Venäjä', 8), ('Bahrein', 8), ('Albanien', 8), ('Tunesien', 8), ('Kasachstan', 7), ('Cap Vert', 7), ('Puola', 7), ('Comoros', 7), ('Vatikanstadt', 7), ('Niue', 7), ('Singapura', 7), ("République islamique d'Iran", 7), ('Îles Caïmans', 7), ('Libye', 6), ('Sierra Leona', 6), ('San Cristóbal y Nieves', 6), ('Estónia', 6), ('Ranska', 6), ('Namíbia', 6), ('Meksiko', 6), ('Guinea Bissau', 6), ('Moldavia', 6), ('Antártida', 6), ('Kreikka', 6), ('Marocko', 6), ('Western Sahara', 6), ('Tchad', 6), ('Saint-Pierre-et-Miquelon', 6), ('Wallis and Futuna', 6), ('Letland', 6), ('Haschemitisches Königreich Jordanien', 6), ('Kiribati', 6), ('Libano', 5), ('Ungern', 5), ('República Islámica de Irán', 5), ('Brasilia', 5), ('Bolivien', 5), ('Malediven', 5), ('Uzbekistán', 5), ('Demokratische Republik Kongo', 5), ('Japani', 5), ('Syrien', 5), ('Sérvia', 5), ('Republic of The Gambia', 5), ('Azerbaiyán', 5), ('Nya Zeeland', 5), ('Islas Marianas del Norte', 5), ('Lettonia', 5), ('República Democrática do Congo', 5), ('Slovacchia', 5), ('Itävalta', 5), ('Islas Caimán', 5), ('Tanzanie', 5), ('Costa de Marfil', 4), ('Namibië', 4), ('Bósnia-Herzegovina', 4), ('Ancienne République yougoslave de Macédoine', 4), ('Papúa Nueva Guinea', 4), ('Albanie', 4), ('Yeni Zelanda', 4), ('Bosnia-Erzegovina', 4), ('Forenede Arabiske Emirater', 4), ('Guiana Francesa', 4), ('Irlanti', 4), ('Tsekin tasavalta', 4), ('Moldawien', 4), ('Moldavie', 4), ('Guinée-Bissau', 4), ('Surinam', 4), ('Cipro', 4), ('Bahreïn', 4), ('Polinesia Francesa', 4), ('Géorgie', 4), ('Slovenië', 4), ('Éthiopie', 4), ('Cocos (Keeling) Islands', 3), ('Antigua-et-Barbuda', 3), ('Maurizio', 3), ('Tyrkia', 3), ('Unkari', 3), ('Lituânia', 3), ('Arménie', 3), ('Seychellen', 3), ('Camerún', 3), ('Ex Repubblica Jugoslava di Macedonia', 3), ('Französisch-Polynesien', 3), ('Mozambico', 3), ('Jamaika', 3), ('Republik Mauritius', 3), ('Guayana Francesa', 3), ('Granada', 3), ('Fidji', 3), ('Algerien', 3), ('Tayikistán', 3), ('Bermudas', 3), ('Etiopía', 3), ('Grækenland', 3), ('Litouwen', 3), ('Antigua y Barbuda', 3), ('Argentinië', 3), ('Islas Vírgenes Británicas', 3), ('Letónia', 3), ('Armenien', 2), ('República das Maurícias', 2), ('Østerrike', 2), ('Sint-Maarten', 2), ('יפן', 2), ('Gambie', 2), ('Kazajistán', 2), ('Kirguistán', 2), ('Vatikanstaten', 2), ('Democratische Republiek Congo', 2), ('Turkki', 2), ('République Populaire Démocratique de Corée (Corée du Nord)', 2), ('Turkmenistán', 2), ('British Indian Ocean Territory', 2), ('Østrig', 2), ('Bosnien-Hercegovina', 2), ('Simbabwe', 2), ('La isla de la Martinica', 2), ('Trinité-et-Tobago', 2), ('Indien', 2), ('Îles Féroé', 2), ('Bosnie-Herzégovine', 2), ('Jemen', 2), ('Bielorussia', 2), ('Botsuana', 2), ('Azerbaïdjan', 2), ('Servië', 2), ('DenTsjekkiske republikk', 2), ('Tuvalu', 1), ('Ouganda', 1), ('Tjekkiet', 1), ('Vaticaanstad', 1), ('Fiyi', 1), ('Nauru', 1), ('Eslovénia', 1), ('Guinea-Bissau', 1), ('Bielo-Russia', 1), ('Y Deyrnas Unedig', 1), ('Hviderusland', 1), ('Färöer-Inseln', 1), ('Kap Verde', 1), ('Nueva Caledonia', 1), ('San Vicente y las Granadinas', 1), ('Förre detta jugoslaviska republiken Makedonien', 1), ('Kambodscha', 1), ('Kirghizistan', 1), ('São Marino', 1), ('Nowa Zelandia', 1), ('Ehemalige jugoslawische Republik Mazedonien', 1), ('Wit-Rusland', 1), ('Libéria', 1), ('Fidschi', 1), ('Kypros', 1), ('Antarctique', 1), ('Ruanda', 1), ('Sveits', 1), ('Cypern', 1), ('Intia', 1), ('Usbekistan', 1), ('Barém', 1), ('Gibilterra', 1), ('Portugali', 1), ('Jamaïque', 1), ('Pitcairn Islands', 1), ('Elfenbeinküste', 1), ('Sambia', 1), ('Santa Lucía', 1), ('Mosambik', 1), ('Republiek Montenegro', 1), ('Union des Comores', 1), ('Frans-Guyana', 1), ('Egypten', 1), ('Trinidad und Tobago', 1), ('Namibie', 1), ('Gabón', 1)]

    return countries


def split_count(text):
    emoji_index_list = []
    data = regex.findall(r'\X', text)
    for grapheme in data:
        if grapheme in emoji.UNICODE_EMOJI:
            emoji_index_list.append(grapheme)
    return emoji_index_list


def get_emoji_cty_distribution(tweets, countries, threshold):
    cty_selected = countries.filter(lambda x: x[1] > threshold)
    cty_selected_key = cty_selected.keys().collect()

    extract_emojis = tweets.map(lambda x: (x[1], list(set(split_count(x[0]))))).reduceByKey(lambda a, b: a+b)
    num_distict_emoji = extract_emojis.map(lambda x: (x[0], len(set(x[1]))))
    num_distict_emoji_selected_cty = num_distict_emoji.filter(lambda x: x[0] in cty_selected_key).sortBy(lambda x: -x[1])
    dist = num_distict_emoji_selected_cty.collect()

    return dist


def plot_distribution(dist, threshold):
    X = [i[0] for i in dist]
    Y = [i[1] for i in dist]
    plt.figure(figsize=(12, 8))
    plt.plot(X, Y, color='blue')
    plt.scatter(X, Y, s=20, color='red')
    # plt.title('Number of Distinct Emoji Used by Country')
    plt.xlabel('Country Code')
    plt.ylabel('Number of Distinct Emoji')
    plt.grid(True)
    plt.savefig('emoji_cty_distribution' + '(' + str(threshold) + ')' + '.png', dpi=600)
    plt.show()


def plot(dist, threshold):
    X = [i[0] for i in dist]
    Y = [i[1] for i in dist]
    plt.figure(figsize=(12, 8))
    plt.plot(X, Y, color='blue')
    plt.scatter(X, Y, s=20, color='red')
    # plt.title('Number of Distinct Emoji Used by Country')
    plt.xlabel('Country Code')
    plt.ylabel('Number of Distinct Emoji')
    plt.xticks(rotation=50)
    plt.grid(True)
    # plt.savefig('emoji_cty_distribution' + '(' + str(threshold) + ')' + '.png', dpi=600)
    plt.show()

threshold = 25000
tweets = select_text_cty(input_file)
countries = get_cty_tweets_distribution(tweets)
dist = get_emoji_cty_distribution(tweets, countries, threshold)
# plot_distribution(dist, threshold)
